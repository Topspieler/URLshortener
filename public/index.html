<html>
  <head>
    <link rel="stylesheet" 
    href="https://cdn.jsdelivr.net/npm/puppertino@1.0.0/dist/css/puppertino.min.css">
    <style> 
    .error {
  border: 1px solid red;
}
body {
  height: 100%;
  position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
      background-color: #f8f4ff;
    }
#textAutoOne {
  font-family:  sans-serif;
  position: fixed;
  top: -20px;
  overflow: hidden;
  white-space: nowrap;
  animation: typing 4.5s steps(20, end), blink-caret 0.75s step-end infinite;
}
form {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  margin: auto;
}
@keyframes typing {
  from { width: 0 }
  to { width: 100% }
}

@keyframes blink-caret {
  from, to { border-color: transparent }
  50% { border-color: #fff }
}
    </style>
  </head>
  
  <body class="p-layout">
    
    
    <form id="url-form" method="POST" class="p-form">
      <div id="textAutoOne"></div>
      <input type="text" id="url-input" class="p-form-input">
      <button type="submit" class="p-form-button" style="margin: 0 auto; display: block;">short it</button>
    </form>    
    <script>


      function isValidUrl(url) {
         return /^(?:(?:(?:https?|ftp):)?\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(url);
      }
      

      async function saveUrl(url) {
        try {
          const response = await fetch('/api/order', {
           method: 'POST',
           headers: {
            'Content-Type': 'application/json'
           },
           body: JSON.stringify({ URL: url })
          });
          const data = await response.json();
          console.log(data.message);
        } catch (error) {
          console.error(error);
        }
      }
      
      const form = document.querySelector('#url-form');
      const urlInput = document.querySelector('#url-input');

      form.addEventListener('submit', event => {event.preventDefault();
      const url = urlInput.value;
      
      if (!isValidUrl(url)) {
          urlInput.classList.add('error');
          urlInput.value = 'enter valid url';
          setTimeout(() => {
           urlInput.classList.remove('error');
          }, 500); 
          setTimeout(() => {urlInput.value = '';}, 500); 
          return;
        }

        saveUrl(url).then(() => {
        urlInput.value = '';
        });



      });

      const text = document.getElementById('textAutoOne');
      const str = 'hello there, please enter your url';
      let i = 0;

      function type() {
         if (i < str.length) {
         text.innerHTML += str.charAt(i);
         text.style.width = i + 1 + 'ch';
          i++;
           setTimeout(type, 100);
        }  else {
             setTimeout(function() {
              text.innerHTML = '';
              i = 0;
             setTimeout(type, 1000);
              }, 5000);
          }
        }

        type();


    </script>
  </body>
</html>
