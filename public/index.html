<html>
  <head>
    <link rel="stylesheet" 
    href="https://cdn.jsdelivr.net/npm/puppertino@1.0.0/dist/css/puppertino.min.css">
    <style> 
    .error {
  border: 1px solid red;
}
body {
  position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
      background-color: #f8f4ff;
    }
    </style>
  </head>
  <body class="p-layout">
    <form id="url-form" method="POST" class="p-form">
      <label for="url-input" class="p-form-label" style="text-align: center;">hello there, please enter your url</label>
      <input type="text" id="url-input" class="p-form-input">
      <button type="submit" class="p-form-button">short it</button>
    </form>    
    <script>
      function isValidUrl(url) {
  return /^(?:(?:(?:https?|ftp):)?\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(url);
}

      async function saveUrl(url) {
        try {
          const response = await fetch('/api/order', {
           method: 'POST',
           headers: {
            'Content-Type': 'application/json'
           },
           body: JSON.stringify({ URL: url })
          });
          const data = await response.json();
          console.log(data.message);
        } catch (error) {
          console.error(error);
        }
      }
      
      const form = document.querySelector('#url-form');
      const urlInput = document.querySelector('#url-input');

      form.addEventListener('submit', event => {event.preventDefault();
      const url = urlInput.value;
      
      if (!isValidUrl(url)) {
          urlInput.classList.add('error');
          urlInput.value = 'enter valid url';
          setTimeout(() => {
           urlInput.classList.remove('error');
          }, 500); 
          setTimeout(() => {urlInput.value = '';}, 500); 
          return;
        }

        saveUrl(url).then(() => {
        urlInput.value = '';
        });



      });


    </script>
  </body>
</html>
